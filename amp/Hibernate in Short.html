<!doctype html>
<html amp lang="en">
  <head>
    <meta charset="utf-8">
    <title>Hibernate in Short</title>
    <link rel="canonical" href="https://abyte.stream/Hibernate-in-Short/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-custom>
        .header-post {
        background-color: rgb(0, 95, 151);
        min-height: 23.25rem;
        width: 100%;
        }
        .header-post .content {
        width: 95%;
        text-align: center;
        padding-top: 8.75rem;
        padding-right: 0px;
        padding-bottom: 4.125rem;
        padding-left: 0px;
        margin-top: auto;
        margin-right: auto;
        margin-bottom: auto;
        margin-left: auto;
        max-width: 50rem;
        }
        .header-post .date {
        font-family: "Open Sans", sans-serif;
        font-weight: 300;
        font-style: normal;
        font-size: 1rem;
        }
        .header-post h1, .header-post .subtitle, .header-post .date {
        color: rgb(255, 255, 255);
        text-align: center;
        }
        h1 {
        font-size: 2em;
        margin-top: 0.67em;
        margin-right: 0px;
        margin-bottom: 0.67em;
        margin-left: 0px;
        }
        h1, h2, h3, h4 {
        font-family: "Open Sans", sans-serif;
        font-weight: 800;
        font-style: normal;
        }
        .header-post h1 {
        font-size: 1.875rem;
        margin-top: 0px;
        margin-right: 0px;
        margin-bottom: 30px;
        margin-left: 0px;
        text-shadow: rgb(0, 76, 121) 3px 3px;
        }
        .header-post .subtitle {
        font-family: "Open Sans", sans-serif;
        font-weight: 300;
        font-style: normal;
        font-size: 1.25rem;
        }
        .header-post a, .header-post p {
        color: rgb(255, 255, 255);
        text-decoration-line: none;
        text-decoration-style: initial;
        text-decoration-color: initial;
        font-family: "Open Sans", sans-serif;
        font-weight: 300;
        font-style: normal;
        font-size: 1.125rem;
        }

        article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
        display: block;
        }
        figure {
        margin-top: 1em;
        margin-right: 40px;
        margin-bottom: 1em;
        margin-left: 40px;
        }
        .highlight {
        margin-top: 1.25rem;
        margin-right: 0px;
        margin-bottom: 1.25rem;
        margin-left: 0px;
        }
        pre {
        overflow-x: auto;
        overflow-y: auto;
        background-image: initial;
        background-position-x: initial;
        background-position-y: initial;
        background-size: initial;
        background-repeat-x: initial;
        background-repeat-y: initial;
        background-attachment: initial;
        background-origin: initial;
        background-clip: initial;
        background-color: rgb(34, 34, 34);
        width: 100%;
        padding-top: 1.25rem;
        padding-right: 0px;
        padding-bottom: 1.25rem;
        padding-left: 0px;
        color: rgb(255, 255, 255);
        margin-top: 1.875rem;
        margin-right: 0px;
        margin-bottom: 1.875rem;
        margin-left: 0px;
        font-size: 0.875rem;
        }
        code, kbd, pre, samp {
        font-family: monospace, monospace;
        font-size: 1em;
        }
        pre code {
        width: auto;
        max-width: 50rem;
        float: none;
        display: block;
        margin-right: auto;
        margin-left: auto;
        padding-top: 0px;
        padding-right: 1.25rem;
        padding-bottom: 0px;
        padding-left: 1.25rem;
        }
        pre code::after {
        clear: both;
        }
        pre span {
        line-height: 1.5rem;
        font-family: Monaco, Consolas, Menlo, monospace;
        }
        .highlight .c, .highlight .cm, .highlight .cp, .highlight .c1, .highlight .cs {
        color: rgb(117, 113, 94);
        }
        .highlight .m, .highlight .n, .highlight .nb, .highlight .ni, .highlight .nl, .highlight .nn, .highlight .py, .highlight .nv, .highlight .w, .highlight .bp, .highlight .vc, .highlight .vg, .highlight .vi {
        color: rgb(164, 208, 67);
        }
        .highlight .o, .highlight .p {
        color: rgb(247, 247, 242);
        }
        .highlight .ld, .highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .si, .highlight .sx, .highlight .sr, .highlight .s1, .highlight .ss {
        color: rgb(230, 219, 116);
        }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
<header class="header-post" role="banner">
        <div class="content" style="transform: translateY(0px); opacity: 1;">
            
                <time itemprop="datePublished" datetime="2018-12-11T18:57:06-05:00" class="date">11 Dec 2018 - sanjaypatel2525</time>
            
            <h1 class="post-title" itemprop="name">Hibernate in Short</h1>
            <p itemprop="description" class="subtitle"></p>
        </div>
</header>
<p>Hibernate, hibernate-jpa, Spring ORM, Spring data JPA and many more. All this seems to be confusing but they all are just jars which are  automatically added when you add the below line you pom.xml.</p>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span> </code></pre></figure>
<p>Basically, Spring boot gives a starter project for your data access layer which is based on ORM concept and by default usage hibernate as persistent api. This blog we are not going to discuss about how spring encapsulated hibernate under it but we are going to discuss about Hibernate basics and there Spring alternative way of writing code. 
<amp-img src="/assets/2019-06-04-Hibernate%20in%20Short.png" alt="gras" width="533" height="401" layout="responsive"><noscript><img src="/assets/2019-06-04-Hibernate%20in%20Short.png" alt="gras" width="533" height="401"></noscript></amp-img></p>
<h3 id="hibernate-in-action-with-jpa">Hibernate in action with JPA.</h3>
<ul>
  <li>Create Entity class</li>
  <li>Create Repository interface</li>
  <li>Use repository.</li>
</ul>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"company"</span><span class="o">)</span> <span class="c1">// Optional as it take class name</span>
<span class="nd">@Document</span> <span class="c1">// incase of nosql DB</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span><span class="o">{</span>
  
  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span> <span class="c1">// Optional asit take field name</span>
  <span class="nd">@GeneratedValue</span> <span class="c1">// Automatically generated values, kind of autoincrement in table.</span>
  <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="nc">String</span> <span class="n">firstname</span><span class="o">;</span>
  <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>
<span class="o">}</span>

<span class="o">....</span>
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">EmployeeRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="nf">findByLastName</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastName</span><span class="o">);</span> <span class="c1">// select * from Employee where lastname=:lastname</span>
<span class="o">}</span>

<span class="o">....</span>
<span class="c1">// Using repository.</span>
<span class="nc">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="n">employeeRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">emps</span> <span class="o">=</span> <span class="n">employeeRepository</span><span class="o">.</span><span class="na">findByLastName</span><span class="o">(</span><span class="s">"Clark"</span><span class="o">);</span>
<span class="n">employeeRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span></code></pre></figure>

<h3 id="pros-and-cons-of-hibernate-over-plain-jdbc">Pros and Cons of Hibernate over Plain JDBC.</h3>
<p>Hibernate is a ORM <strong>Object-relational mapping</strong>, It maps the entity classes to database tables. Sometime it easy to map one to one entity to table but sometime it really gets complex when you have inheritance, different kind of table relationships such as one to one, one to many and  many to many. Also it really gets messy if you don’t handle the fetch and cascade parameters properly. But over all it has many advantages over its disadvantages. That why it is so popular.</p>
<ul>
  <li>Reduces and reusage code.<br>
You don’t need write query again and again for insert update or anything.</li>
  <li>Independent of database.
You can use any underlying database without modifying your code. You just need change dialect and pom entry to update driver of the database. <br>
<em>spring.jpa.properties.hibernate.dialect =  org.hibernate.dialect.DB2Dialect</em>
</li>
</ul>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">com</span><span class="o">.</span><span class="na">ibm</span><span class="o">.</span><span class="na">db2</span><span class="o">.</span><span class="na">jcc</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">db2jcc4</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span></code></pre></figure>
<ul>
  <li>Lazy loading.<br>
Hibernate you can set the property to lazy load the related table data and hibernate takes care of fetching the data when the data is required.</li>
  <li>Transaction management.<br>
Hibernate maintains the transaction and revert all the changes in case if there is any exception.</li>
  <li>Caching.<br>
In memory is always faster then the reaching out to DB for the data. Hibernate has inmemory caching option it keeps data in memory which is faster to access and is very smart when to commit and when not to.</li>
  <li>Connection Pooling.<br>
Inbuilt support of connection pooling. It create pool of connection which is faster then creating a new connection and terminating it.</li>
  <li>Supports HQL(superset of JPQL).<br>
HQL is a query language supported in Hibernates, In queries you can directly use classname and it automatically generates the database queries.</li>
  <li>Automatic versioning.<br>
Maintains different version of data and saves the headach of missing the data.</li>
  <li>Performance<br>
The query generated here will be highly optimized in most of the cases.</li>
</ul>

<h3 id="setting-up-datasource">Setting up Datasource.</h3>
<p>If you start with starter-jpa datasource and started inmemory DB jar such as h2database etc, you don’t need to define the datasource but you can define and override the default ones. Here is Java way of defining it.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">DriverManagerDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DriverManagerDataSource</span><span class="o">();</span>
 
    <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="o">);</span>
    <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"admin"</span><span class="o">);</span>
    <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
    <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span>
      <span class="s">"jdbc:mysql://localhost:3306/testDB?createDatabaseIfNotExist=true"</span><span class="o">);</span> 
     
    <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>
<p>Here is defining the datasource by just property files. Make sure you use exact keys.</p>
<figure class="highlight"><pre><code class="language-property" data-lang="property">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=admin
spring.datasource.password=password
spring.datasource.url=jdbc:mysql://localhost:3306/testDB?createDatabaseIfNotExist=true</code></pre></figure>

<h3 id="object-states-in-hibernate">Object States in Hibernate</h3>
<ul>
  <li>Transient<br>
Object just created but not attached to hibernate session and not connected to database.</li>
  <li>Persistent<br>
Object attached hibernate session and connected to database, any update to this will be reflected in database.</li>
  <li>Detached<br>
Object detached from session. It happened when session is closed or you can manually detach it.</li>
</ul>

<h3 id="session-sessionfactory-and-transaction">Session, SessionFactory and Transaction.</h3>
<p>SessionFactory provide you the session class which can be used to attach, detach, save, query etc. Session supports transaction as well.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="k">try</span> <span class="o">{</span>
   <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
   <span class="c1">// do some work</span>
   <span class="o">...</span>
  <span class="n">session</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
   <span class="o">...</span>
   <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>

<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">tx</span><span class="o">!=</span><span class="kc">null</span><span class="o">)</span> <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span> 
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
   <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<h3 id="annotations-used-class-table-mapping">Annotations used class table mapping.</h3>
<p><strong>@Entity</strong> - Makes the class available for Table mapping.<br>
<strong>@Table</strong> - It is optional. Used with @Entity, in case you want different name of the table.<br>
<strong>@Column</strong> - It is optional, in case you want different name of the field.<br>
<strong>@Id</strong> - Makes field primary key, you will have to use @GeneratedValue if you want generated values of id.<br>
<strong>@GeneratedValue</strong> - To generate field value. There four type of it. Auto(Unique value across database), identity(Unique across class hierarchy), sequence(custom sequence ex:start:100, increment- 10), Table.<br>
<strong>@Version</strong> - For versioning and concurrency you can keep a field which defines a version.<br>
<strong>@Transient</strong> - In case you don’t want a field to be part of database mapping.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee_Custom_Table_Name"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span> <span class="c1">// column name defaults to first_name</span>
  
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"custom_last_name"</span><span class="o">)</span> <span class="c1">// column name is specified,  custom_last_name</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span> 

  <span class="nd">@Version</span>
  <span class="kd">private</span> <span class="nc">Date</span> <span class="n">lastUpdate</span><span class="o">;</span>

  <span class="nd">@Transient</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">sessionId</span><span class="o">;</span> <span class="c1">// will not be stored in db</span>
<span class="o">}</span></code></pre></figure>

<h2 id="mapping-tables">Mapping Tables.</h2>
<p><strong>@OnetoOne</strong> - When there is one to one relation, but again it has four different types.<br>
<strong>@PrimaryKeyJoinColumn</strong> - When two table share same primary key. Such as Employee and EmployeeDetails.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
   
  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
   
  <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">MERGE</span><span class="o">)</span>
  <span class="nd">@PrimaryKeyJoinColumn</span>
  <span class="kd">private</span> <span class="nc">EmployeeDetail</span> <span class="n">employeeDetail</span><span class="o">;</span>
   
  <span class="o">...</span>
<span class="o">}</span>
 
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee_detail"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeDetail</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
 
  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
   
  <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

<p><strong>@MapsId</strong> - When tables joined by foreign and primary key of two tables and both class cotains object of each other. Such Employee and EmployeeBadge.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
 
  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
   
  <span class="nd">@OneToOne</span>
  <span class="nd">@MapsId</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee_badge_id"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">EmployeeBadge</span> <span class="n">employeeBadge</span><span class="o">;</span>
   
  <span class="o">...</span>
<span class="o">}</span>
 
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee_badge"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeBadge</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
 
  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ID"</span><span class="o">)</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
 
  <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"employee"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Employee</span> <span class="n">employee</span><span class="o">;</span>
 
  <span class="o">....</span>
<span class="o">}</span></code></pre></figure>

<p><strong>@OneToMany &amp; @ManyToOne</strong> - Both are represent same logical thing. A Project can have many employees which is one to many. Many employee can be mapped a single project which is many to one. It depends how you organize your java class.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// One to Many example. </span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"project"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Project</span><span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="nc">Long</span> <span class="n">projectId</span><span class="o">;</span>

  <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"project"</span><span class="o">)</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"projectId"</span><span class="o">)</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span><span class="o">;</span>
  <span class="o">....</span>
<span class="o">}</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span><span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="nc">Long</span> <span class="n">employeeId</span><span class="o">;</span>
  <span class="o">....</span>
<span class="o">}</span>

<span class="c1">// Many to one example</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"project"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Project</span><span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="nc">Long</span> <span class="n">projectId</span><span class="o">;</span>
  <span class="o">....</span>
<span class="o">}</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span><span class="o">{</span>
  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"projectId"</span><span class="o">)</span> <span class="c1">// if this annotation not present it defaults to table relation @JoinTable(name = "project_employee")</span>
  <span class="nc">Project</span> <span class="n">project</span><span class="o">;</span>
  <span class="o">.....</span>
<span class="o">}</span>

<span class="c1">// all of the above was unidirectional relation using a foreign key in Employee as projectid. We can do the same relation with third relation table.</span></code></pre></figure>

<p><strong>@ManyToMany</strong> - Many to many relation always needs a third table. For example employee can work on many tasks and a task can have multiple employees working on it.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"task"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span><span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="nc">Long</span> <span class="n">taskId</span><span class="o">;</span>

  <span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"tasks"</span><span class="o">)</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span>
  <span class="o">....</span>
<span class="o">}</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span><span class="o">{</span>
  <span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="o">{</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span> <span class="o">})</span>
  <span class="nd">@JoinTable</span><span class="o">(</span>
      <span class="n">name</span> <span class="o">=</span> <span class="s">"Employee_Project"</span><span class="o">,</span> 
      <span class="n">joinColumns</span> <span class="o">=</span> <span class="o">{</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee_id"</span><span class="o">)</span> <span class="o">},</span> 
      <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="o">{</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"task_id"</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">)</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="o">;</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="nc">Long</span> <span class="n">employeeId</span><span class="o">;</span>
  <span class="o">.....</span>
<span class="o">}</span></code></pre></figure>

<h3 id="hql-query">HQL Query.</h3>
<p>Hibernates provides many way to query you table. Native, HQL, criteria etc. HQL is extension of SQL almost same as SQL standards but it usage class name in place of table name. Also, binging a value is very easy. You can retrieve query object from session and Query interface has following methods.</p>
<ul>
  <li>public int executeUpdate()</li>
  <li>public List list()</li>
  <li>public Query setFirstResult(int rowno) //For pagination set the first row num</li>
  <li>public Query setMaxResult(int rowno) // Page count</li>
  <li>public Query setParameter(int position, Object value)</li>
  <li>public Query setParameter(String name, Object value)</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"FROM Employee E WHERE E.id = :employee_id"</span><span class="o">;</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"employee_id"</span><span class="o">,</span><span class="mi">1000</span><span class="o">);</span>
<span class="nc">List</span> <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="o">....</span>

<span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"UPDATE Employee set age = :age "</span>  <span class="o">+</span> 
             <span class="s">"WHERE id = :empId"</span><span class="o">;</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="mi">25</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"empId"</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Rows affected: "</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span></code></pre></figure>

<h3 id="criteria-api">Criteria API.</h3>
<p>Criteria api helps you to omit sqls or HQL where you have to pass the query as string. Criteria API provides you set of classes and utilities with which you can form queries. You can create Criteria object form session.</p>

<p>Criteria ct = session.createCriteria(Employee.class);
List<employee> results = ct.list();</employee></p>

<p><strong>Using Restriction</strong> - Restriction class with and, or, eq, ne, gt, lt, ge, le, like,ilike, between, in, conjunction, disjunction, isNull, isNotNull, sqlRestriction(String sql, Object value, Type type) etc.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Criteria</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">ct</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Restrictions</span><span class="o">.</span><span class="na">lt</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span><span class="mi">20</span><span class="o">));</span>
<span class="n">ct</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Restrictions</span><span class="o">.</span><span class="na">sqlRestriction</span><span class="o">(</span><span class="s">"{alias}.firstname like 'San%'"</span><span class="o">));</span>
<span class="n">ct</span><span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">ct</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
<span class="n">ct</span><span class="o">.</span><span class="na">addOrder</span><span class="o">(</span><span class="nc">Order</span><span class="o">.</span><span class="na">desc</span><span class="o">(</span><span class="s">"age"</span><span class="o">));</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="na">list</span><span class="o">()</span></code></pre></figure>

<p><strong>Using Projection to get selecte Columns</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Criteria</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">ProjectionList</span> <span class="n">projList</span> <span class="o">=</span> <span class="nc">Projections</span><span class="o">.</span><span class="na">projectionList</span><span class="o">();</span>
<span class="n">projList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">));</span>
<span class="n">projList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"lastName"</span><span class="o">));</span>
<span class="n">ct</span><span class="o">.</span><span class="na">setProjection</span><span class="o">(</span><span class="n">projList</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="nc">Criteria</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">ct</span><span class="o">.</span><span class="na">setProjection</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">rowCount</span><span class="o">());</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre></figure>

<ul>
  <li>avg(String propertyName)</li>
  <li>count(String propertyName)</li>
  <li>countDistinct(String propertyName</li>
  <li>max(String propertyName)</li>
  <li>min(String propertyName)</li>
  <li>sum(String propertyName)</li>
</ul>

<p><strong>Using query by example</strong>
Query by example usage a filter object. Let’s say you want filter a employee based on salary and age. Create a filter object with salary and age set.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Employee</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Employee</span><span class="o">();</span>
<span class="n">e</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
<span class="n">e</span><span class="o">.</span><span class="na">setSalary</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
<span class="nc">Criteria</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">ct</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Example</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">e</span><span class="o">));</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre></figure>

<h3 id="native-queries">Native queries.</h3>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT * FROM EMPLOYEE WHERE id = :employee_id"</span><span class="o">;</span>
<span class="nc">SQLQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createSQLQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">addEntity</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"employee_id"</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre></figure>

<h2 id="caching-in-hibernate">Caching in Hibernate.</h2>
<p>Hibernates has two level level of cache. First level is by default there and maintained by session container. You can’t change first level cache. Second level cache is left for developer where he can defined his own caching strategies at each class level. Such as Employee class secondary cache can use any of the below strategies.<br>
<strong>Transactional</strong> - Cached data will be retained only in transaction.<br>
<strong>Read-write</strong> - It create read write lock on table and updates if the data has been updated.<br>
<strong>Nonstrict-read-write</strong> - When data rarely changes and you don’t bother about stale data.
<strong>Read-only</strong> - When data never changes.</p>

<footer>
  <p>Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a></p>
</footer>
</body>
</html>