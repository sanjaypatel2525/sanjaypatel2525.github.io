<!doctype html>
<html amp lang="en">
  <head>
    <meta charset="utf-8">
    <title>Spring Boot JUnit with Mockito.</title>
    <link rel="canonical" href="https://abyte.stream/Spring-Boot-JUnit-with-Mockito/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-custom>
        .header-post {
        background-color: rgb(0, 95, 151);
        min-height: 23.25rem;
        width: 100%;
        }
        .header-post .content {
        width: 95%;
        text-align: center;
        padding-top: 8.75rem;
        padding-right: 0px;
        padding-bottom: 4.125rem;
        padding-left: 0px;
        margin-top: auto;
        margin-right: auto;
        margin-bottom: auto;
        margin-left: auto;
        max-width: 50rem;
        }
        .header-post .date {
        font-family: "Open Sans", sans-serif;
        font-weight: 300;
        font-style: normal;
        font-size: 1rem;
        }
        .header-post h1, .header-post .subtitle, .header-post .date {
        color: rgb(255, 255, 255);
        text-align: center;
        }
        h1 {
        font-size: 2em;
        margin-top: 0.67em;
        margin-right: 0px;
        margin-bottom: 0.67em;
        margin-left: 0px;
        }
        h1, h2, h3, h4 {
        font-family: "Open Sans", sans-serif;
        font-weight: 800;
        font-style: normal;
        }
        .header-post h1 {
        font-size: 1.875rem;
        margin-top: 0px;
        margin-right: 0px;
        margin-bottom: 30px;
        margin-left: 0px;
        text-shadow: rgb(0, 76, 121) 3px 3px;
        }
        .header-post .subtitle {
        font-family: "Open Sans", sans-serif;
        font-weight: 300;
        font-style: normal;
        font-size: 1.25rem;
        }
        .header-post a, .header-post p {
        color: rgb(255, 255, 255);
        text-decoration-line: none;
        text-decoration-style: initial;
        text-decoration-color: initial;
        font-family: "Open Sans", sans-serif;
        font-weight: 300;
        font-style: normal;
        font-size: 1.125rem;
        }

        article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
        display: block;
        }
        figure {
        margin-top: 1em;
        margin-right: 40px;
        margin-bottom: 1em;
        margin-left: 40px;
        }
        .highlight {
        margin-top: 1.25rem;
        margin-right: 0px;
        margin-bottom: 1.25rem;
        margin-left: 0px;
        }
        pre {
        overflow-x: auto;
        overflow-y: auto;
        background-image: initial;
        background-position-x: initial;
        background-position-y: initial;
        background-size: initial;
        background-repeat-x: initial;
        background-repeat-y: initial;
        background-attachment: initial;
        background-origin: initial;
        background-clip: initial;
        background-color: rgb(34, 34, 34);
        width: 100%;
        padding-top: 1.25rem;
        padding-right: 0px;
        padding-bottom: 1.25rem;
        padding-left: 0px;
        color: rgb(255, 255, 255);
        margin-top: 1.875rem;
        margin-right: 0px;
        margin-bottom: 1.875rem;
        margin-left: 0px;
        font-size: 0.875rem;
        }
        code, kbd, pre, samp {
        font-family: monospace, monospace;
        font-size: 1em;
        }
        pre code {
        width: auto;
        max-width: 50rem;
        float: none;
        display: block;
        margin-right: auto;
        margin-left: auto;
        padding-top: 0px;
        padding-right: 1.25rem;
        padding-bottom: 0px;
        padding-left: 1.25rem;
        }
        pre code::after {
        clear: both;
        }
        pre span {
        line-height: 1.5rem;
        font-family: Monaco, Consolas, Menlo, monospace;
        }
        .highlight .c, .highlight .cm, .highlight .cp, .highlight .c1, .highlight .cs {
        color: rgb(117, 113, 94);
        }
        .highlight .m, .highlight .n, .highlight .nb, .highlight .ni, .highlight .nl, .highlight .nn, .highlight .py, .highlight .nv, .highlight .w, .highlight .bp, .highlight .vc, .highlight .vg, .highlight .vi {
        color: rgb(164, 208, 67);
        }
        .highlight .o, .highlight .p {
        color: rgb(247, 247, 242);
        }
        .highlight .ld, .highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .si, .highlight .sx, .highlight .sr, .highlight .s1, .highlight .ss {
        color: rgb(230, 219, 116);
        }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
<header class="header-post" role="banner">
        <div class="content" style="transform: translateY(0px); opacity: 1;">
            
                <time itemprop="datePublished" datetime="2018-12-11 18:57:06 -0500" class="date">2018-12-11 18:57:06 -0500 - sanjaypatel2525</time>
            
            <h1 class="post-title" itemprop="name">Spring Boot JUnit with Mockito.</h1>
            <p itemprop="description" class="subtitle"></p>
        </div>
</header>
<p>There are cases when you want to write test cases for your method, but the method itself usage some other method or service, in these scenarios we try to skip the inner methods call or service by mocking it up.</p>

<p>Mockito is very famous mocking api. With this you can mock any object and just focus on testing of your method only.</p>

<p>Let’s quickly jump into Spring boot JUnit configuration. Add following lines in pom.xml</p>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>
<p>Once you add boot starter, it will automatically add following dependencies to your project.</p>
<ul>
  <li>Basic JUnit.</li>
  <li>Spring unit test framework</li>
  <li>Asserts - AssertJ, Hamcrest Assert, JSONAssert, Java assert</li>
  <li>Mockito.</li>
</ul>

<h3 id="small-example">Small example.</h3>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">xyz</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeDao</span> <span class="o">{</span>
    <span class="o">...</span>
	<span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getEmployee</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">....</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="o">.....</span>

<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">xyz</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeBOImpl</span> <span class="o">{</span>
    <span class="nd">@Autowire</span> <span class="kd">public</span> <span class="n">EmployeeDao</span> <span class="n">employeeDao</span><span class="o">;</span>
    <span class="o">...</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isManager</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">getEmployee</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">emp</span><span class="o">.</span><span class="na">getRole</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"MANAGER"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="o">....</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeBOImplTest</span><span class="o">{</span>
    <span class="kd">public</span> <span class="n">EmployeeBOImpl</span> <span class="n">employeeBOImpl</span><span class="o">;</span>

    <span class="o">...</span>
    <span class="nd">@Before</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">()</span> <span class="o">...</span>

	<span class="nd">@After</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">after</span><span class="o">()</span> <span class="o">...</span>

	<span class="nd">@BeforeClass</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">beforeClass</span><span class="o">()...</span>

	<span class="nd">@AfterClass</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afterClass</span><span class="o">()...</span>
    <span class="o">...</span>

    <span class="c1">//this method will fails with null pointer exception as employeeDao is not defined for this object.</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testEmployeeBad</span><span class="o">(){</span>
        <span class="n">employeeBOImpl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EmployeeBOImpl</span><span class="o">();</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">employeeBOImpl</span><span class="o">.</span><span class="na">isManager</span><span class="o">());</span> 
    <span class="o">}</span>

    <span class="c1">//Use mockito to mock employeeDao</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testEmployeeGood</span><span class="o">(){</span>
        <span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">();</span>
        <span class="n">emp</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="s">"MANAGER"</span><span class="o">);</span>
        
        <span class="n">EmployeeDao</span> <span class="n">employeeDao</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="n">EmployeeDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">when</span><span class="o">(</span><span class="n">employeeDao</span><span class="o">.</span><span class="na">getEmployee</span><span class="o">(</span><span class="n">anyInt</span><span class="o">())).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>

        <span class="n">employeeBOImpl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EmployeeBOImpl</span><span class="o">();</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">employeeBOImpl</span><span class="o">.</span><span class="na">isManager</span><span class="o">());</span> 
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>
<h2 id="common-mockito-function-and-usage">Common Mockito function and usage.</h2>
<p><strong>Using Mockito annotation</strong> In order to make mockito annotations work you would to use one of the below methods.</p>
<ul>
  <li>Init Mockito first – MockitoAnnotations.initMocks(this)</li>
  <li>Or use Mockito runner – @RunWith(MockitoJUnitRunner.class)
    <h3 id="doreturnwhen">doReturn+when</h3>
    <p>Earlier we have sued when with then return, ‘when+thenReturn’ has some limitation such it can’t work void method also, if you don’t use mocked object in ‘when’ it might call function on actual object and throw some errors. While doreturn+when handles both the scenarios well. It doesn’t call actually method of object but it mocks the function call.<br>
<em>doReturn(emp).when(emp).getEmployee(anyInt());</em></p>
    <h3 id="dothrowwhen">doThrow+when</h3>
    <p>Same as doRetrun, doThrow can throw a exception on specific method of the object.
<em>doThrow(NullPointerException.class).when(emp).getEmployee(anyInt());</em></p>
    <h3 id="add-a-spy">Add a Spy</h3>
    <p>Mockito provide a utility a object which keeps an eye on the target object. It tracks the interactions on target object.</p>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="n">spy</span><span class="o">(</span><span class="k">new</span> <span class="n">Employee</span><span class="o">());</span>
<span class="n">emp</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="s">"MANAGER"</span><span class="o">);</span>  <span class="c1">// the real setRole method is called. </span>
<span class="n">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">emp</span><span class="o">).</span><span class="na">setRole</span><span class="o">(</span><span class="s">"MANAGER"</span><span class="o">)</span>  <span class="c1">// It return true, as setRole was already called on this object.</span>
<span class="n">when</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getRole</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"MANAGER"</span><span class="o">);</span> <span class="c1">// real method will called here and can throw exception. so use doReturn in place.  </span></code></pre></figure>
<h3 id="call-real-object">Call real object</h3>
<p>In a class you can mock all the methods, but in case you want to call a real method on the class. 
<em>when(emp.getId()).thenCallRealMethod(); // will call real method rather than mocked one.</em></p>
<h3 id="injectmock">@InjectMock</h3>
<p>Inject mock takes a mock object and inserts into another object just like autowiring.</p>

<h3 id="mock-vs-spy">Mock vs Spy.</h3>
<p>Spy is a wrapper around actual instance and tracks the activity on instance while mock is bare-bone mocked instance created for the class. Use spy when you want to track activity on object it works on actually object, use mock when you just want bare-bone object of the class. 
EmployeeDao employeeDao = mock(EmployeeDao.class); // create a mocked object of the class
EmployeeDao employeeDao = spy(new EmployeeDao()));  //creates new actual object and wraps a spy</p>

<h3 id="argumentmatcher">ArgumentMatcher</h3>
<p>You might have seen <em>anyInt(), anyString()</em> passed in argument of method when using ‘when’ or doReturn feature of mockito. These are ArgumentMatcher, you don’t need to pass actual values but can match with a argument type or so. For custom class you can use <em>any(CustomClass.class)</em>. There is option to create customer matcher as well.</p>
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomMatcher</span> <span class="kd">implements</span> <span class="n">ArgumentMatcher</span><span class="o">&lt;</span><span class="n">CustomClass</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">CustomClass</span> <span class="n">customClass</span><span class="o">;</span>
    <span class="c1">// constructors</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="n">customClass</span> <span class="n">customClass</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// do something and return if matches.</span>
    <span class="o">}</span>
<span class="o">}</span> </code></pre></figure>

<footer>
  <p>Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a></p>
</footer>
</body>
</html>